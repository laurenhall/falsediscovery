# falsediscovery
Supporting material for an exploration of the false discovery rate in open access journals.

### Code provided:
- Functions.R - R code containing all necessary functions to perform journal selection and FDR estimation. Functions provided by Jager and Leek (2013) are identified within this file. *Requires RCurl, XML, tm, stats4, genefilter, and stringr libraries.*
- JournalSelection.R - R code for collecting data from the journal list. Downloads abstracts, excludes journals with no abstracts for one or more years, performs FDR estimation, and excludes journals with FDR estimates of "NA" for one or more years. Exports FDR estimates and journal details to create data sets for analysis. *Requires Functions.R source code.*
- JournalModels.R - R code for performing analysis on data sets partially generated by JournalSelection.R. Fits the linear mixed effects models which appear in the main text and supplemental materials. *Requires the nlme library.*
 
### Data provided:
- journals.csv - The list of candidate journals collected from InCites, as journal abbreviations.
- data_final.csv - Data set containing 108 journals, covariates + FDR estimates generated by JournalSelection.R. 
- data_final_nz.csv - Data set containing 97 journals, a subset of data_final with journals with FDR estimates effectively zero (expected number of false discoveries < 0.01; zero false discovery p-values in sample) removed from consideration.
- data_final_ns.csv - Data set containing 102 journals, a subset of data_final with journals that switched from non-open access to open access during the study years (and were therefore tagged as both OA and not OA) removed from consideration.
- data_fnal_nzns.csv - Data set containing 94 journals, a subset of data_final with both journals with FDR estimates effectively zero and journals that switched open access status removed. **This is the data set used in the main text.**

### How to use these files to replicate the work of L. Hall and A. Hendricks:
1. Make sure all required R libraries (RCurl, XML, tm, stats4, genefilter, stringr, and nlme) are installed. RCurl and XML may require additional dependencies depending on your operating system. genefilter is available through Bioconductor. 
2. Run the R code found in `JournalSelection.R` to replicate the data collection process. This will generate the FDR estimates found in the data files and output partial data sets containing Journal, Year, and Estimate.
3. The remaining covariates in the data sets can be verified by searching with journal abbreviations or full journal name on InCites. The two-year JIF and Open Access status for each journal is listed in the details of the journal.
4. To replicate the analysis of the data, run the R code found in `JournalModels.R`. 

### How to use these files to perform analysis on a new set of journals
1. In the JournalSelection.R file, replace "`journals.csv`" with a list of new journals (abbreviation as listed in the PubMed database is preferred, but full titles will often work just as well), and replace "`years`" with the desired years.
    - In order to use a database other than PubMed, the first function in `Functions.R` (provided by Leek and Jager) would need to be modified to draw from the new database.
2. Run the first part of the Journal Selection code to download abstracts from PubMed and collect the p-values and p-value summary data (up through line 97). 
3. View the p-value summary tables. The "`nna`" (number of NA values) and "`nmr`" (number of p-values misread as less than 0 or greater than 1) tables will indicate if there are any journals that are using text formatting that the p-value scraping algorithm is misreading.
    - If a journal has a high number of NA values relative to its number of p-values (`npval`), there is a problem in the source formatting of the abstracts that is causing the p-value scraping to misread the p-values. To correct this, export/view one or more abstracts from the offending journal; for example:
       
```
# Journal name is stored in column 1, p-value in column 3
problem_index = which(pvaldat[,1] == "The Journal" & is.na(pvaldat[,3]) == TRUE)
# Abstracts are stored in column 6
problem_abstracts = pvaldat[problem_index,6] 
write.table(problem_abstracts, file="problem_abstracts.txt")
```
4. Once the abstracts are collected:
    - Read through the abstracts and assess the way their p-values are presented. Identify the most likely cause of the mis-read; errors are most commonly caused by unusual characters or uncommon notation (for example: finding "`P = 0·001`" in place of "`P = 0.001`"; or "`P => 0.05`" in place of "`P ≥ 0.05`"). Additionally, the specific string of characters read by the algorithm (ex: "`> 0.05`" for "`P => 0.05`") are stored alongside the p-values in the pvaldat object (ex: `problem_strings = pvaldat[problem_index,8]`) and can be used to verify the specific character(s) causing the problem.
    - Once a problem has been identified, update the `standardize()` function in `Functions.R` to replace the offending character(s) with more standard ones in the abstract text (ex. `abstract = gsub("=>", ">", abstract)` replaces the unusual notation "=>" with a character not containing an equal sign ">", preventing the algorithm from erroneously reading the ">"as part of a number). 
    - Run the p-value collection function again and verify that the issue has been corrected.
 5. If satisfied with the p-value data collected (i.e. journal abstracts are being read correctly), run the remainder of the Journal Selection code to obtain FDR estimates for the journals.
    - Note that even when abstracts are being read correctly, the EM algorithm will occasionally fail to converge to due to insufficient data or an insufficient number of distinct p-values (ex. all p-values listed as "P < 0.01")
 6. Export the FDR estimates, journal titles, and years to a .csv file.
 7. To use the same covariates as the original study, navigate to InCites and search by journal name or abbreviation. Append the .csv file containing the journals, years, and FDR estimates with the two-year JIF and Open Access stats of each journal at each year.
 8. Read in the collected data, and using the `nlme` R package, fit an appropriate linear mixed effects model to your data.
    - We suggest the use of JIF, OA, and JIF\*OA as covariates, and Journal as the random factor. 
